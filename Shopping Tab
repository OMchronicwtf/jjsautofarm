-- ShopTabModule.lua

return function(Window, StockTable, Event)
    -- Create Shop Tab
    local ShopTab = Window:CreateTab("Shop", 4483362458) -- 4483362458 is a Lucide icon ID, change if needed

    -- Create Shop Section
    local ShopSection = ShopTab:CreateSection("Stock Items")

    -- Prepare dropdown options from StockTable
    local dropdownOptions = {}
    for key, item in pairs(StockTable) do
        table.insert(dropdownOptions, key .. " | " .. item.Name .. " - " .. item.Price)
    end

    -- Selected item storage
    local selectedItem = nil

    -- Create dropdown
    local ItemDropdown = ShopSection:CreateDropdown({
        Name = "Select Item",
        Options = dropdownOptions,
        CurrentOption = {},
        MultipleOptions = false,
        Flag = "ShopDropdown",
        Callback = function(option)
            -- Extract the MV key from selection
            selectedItem = option:match("^(%w+)")
        end,
    })

    -- Create Purchase button
    local PurchaseButton = ShopSection:CreateButton({
        Name = "Purchase",
        Callback = function()
            if selectedItem then
                Event:FireServer({
                    Item = selectedItem,
                    Type = "StockBuy"
                })
                Rayfield:Notify({
                    Title = "Shop",
                    Content = "Purchased: " .. StockTable[selectedItem].Name,
                    Duration = 4,
                    Image = "shopping-cart"
                })
            else
                Rayfield:Notify({
                    Title = "Shop",
                    Content = "No item selected!",
                    Duration = 4,
                    Image = "alert-circle"
                })
            end
        end,
    })

    return ShopTab
end
