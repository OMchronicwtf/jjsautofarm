-- ShopTabModule.lua

return function(Window, StockTable, Event)
    local ShopTab = Window:CreateTab("Shop", 4483362458) -- Lucide icon, change if needed
    local ShopSection = ShopTab:CreateSection("Stock Items")

    -- Prepare dropdown options
    local dropdownOptions = {}
    for key, item in pairs(StockTable) do
        table.insert(dropdownOptions, key .. " | " .. item.Name .. " - " .. item.Price)
    end

    local selectedItem = nil

    local ItemDropdown = ShopSection:CreateDropdown({
        Name = "Select Item",
        Options = dropdownOptions,
        CurrentOption = {},
        MultipleOptions = false,
        Flag = "ShopDropdown",
        Callback = function(option)
            selectedItem = option:match("^(%w+)")
        end
    })

    ShopSection:CreateButton({
        Name = "Purchase",
        Callback = function()
            if selectedItem and StockTable[selectedItem] then
                Event:FireServer({
                    Item = selectedItem,
                    Type = "StockBuy"
                })
                Rayfield:Notify({
                    Title = "Shop",
                    Content = "Purchased: " .. StockTable[selectedItem].Name,
                    Duration = 4,
                    Image = "shopping-cart"
                })
            else
                Rayfield:Notify({
                    Title = "Shop",
                    Content = "No item selected!",
                    Duration = 4,
                    Image = "alert-circle"
                })
            end
        end
    })

    return ShopTab
end
