-- ShopTabModule.lua
-- Module for Jututsu Seas Shop Tab

-- Always return a function to avoid breaking tab loading
return function(Window, StockTable, Event)
    -- Create the Shop tab
    local ShopTab = Window:CreateTab("Shop", 4483362458) -- Lucide icon ID

    -- Create a section inside the Shop tab
    local ShopSection = ShopTab:CreateSection("Stock Items")

    -- Build dropdown options dynamically from StockTable
    local dropdownOptions = {}
    for key, item in pairs(StockTable) do
        table.insert(dropdownOptions, key .. " | " .. item.Name .. " - " .. item.Price)
    end

    local selectedItem = nil -- stores current selection

    -- Create dropdown to select items
    ShopSection:CreateDropdown({
        Name = "Select Item",
        Options = dropdownOptions,
        CurrentOption = {},
        MultipleOptions = false,
        Flag = "ShopDropdown",
        Callback = function(option)
            -- Extract the MV key from the dropdown string
            selectedItem = option:match("^(%w+)")
        end
    })

    -- Create purchase button
    ShopSection:CreateButton({
        Name = "Purchase",
        Callback = function()
            if selectedItem and StockTable[selectedItem] then
                -- Fire the purchase event
                Event:FireServer({
                    Item = selectedItem,
                    Type = "StockBuy"
                })
                -- Notify the user of success
                Rayfield:Notify({
                    Title = "Shop",
                    Content = "Purchased: " .. StockTable[selectedItem].Name,
                    Duration = 4,
                    Image = "shopping-cart"
                })
            else
                -- Notify the user if no selection is made
                Rayfield:Notify({
                    Title = "Shop",
                    Content = "No item selected!",
                    Duration = 4,
                    Image = "alert-circle"
                })
            end
        end
    })

    return ShopTab
end
